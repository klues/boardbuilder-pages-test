!function(){var e,t,a,i,n,r,o,c,l,s,d,u,p,f,g,b,h,m,v,Z,S,T,A,x,y;function z(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function D(e,t,a){return t&&P(e.prototype,t),a&&P(e,a),e}(self.webpackChunkboardbuilder=self.webpackChunkboardbuilder||[]).push([[555],{98555:function(P,w,C){"use strict";C.r(w),C.d(w,{PdfModule:function(){return Ze},routes:function(){return ve}});var J=C(61116),k=C(33464),Q=C(87672),F=C(35965),$=C(84369),N=C(73291),O=C(82051),E=C(46024),Y=function(){function e(){q(this,e)}return D(e,[{key:"deserialise",value:function(e){return e.pageSize&&(this.pageSize=(new E.t).deserialise(e.pageSize)),Object.assign(this,e)}}]),e}(),_=C(35366),I=C(91286),M=C(529),j=C(79996),L=C(42693),R=function(){var e=function(){function e(t){q(this,e),this.http=t,this.apiEndpoint="".concat(M.N.boardBuilderApiBase,"/templates")}return D(e,[{key:"pageSizes",value:function(){return this.http.get("".concat(this.apiEndpoint,"/page_sizes")).pipe((0,j.U)(function(e){return e.map(function(e){return(new E.t).deserialise(e)})}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.LFG(L.eN))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),U=C(99624),B=C(98508),H=C(13070),G=C(13841),V=C(87064),W=C(6489),K=C(40994),X=C(31041),ee=C(24311),te=C(77307),ae=C(40936),ie=function(){var e=function(){function e(t){q(this,e),this.sanitiser=t}return D(e,[{key:"transform",value:function(e,t){switch(t){case"html":return this.sanitiser.bypassSecurityTrustHtml(e);case"style":return this.sanitiser.bypassSecurityTrustStyle(e);case"script":return this.sanitiser.bypassSecurityTrustScript(e);case"url":return this.sanitiser.bypassSecurityTrustUrl(e);case"resourceUrl":return this.sanitiser.bypassSecurityTrustResourceUrl(e);default:return this.sanitiser.bypassSecurityTrustHtml(e)}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(U.H7,16))},e.\u0275pipe=_.Yjl({name:"bypassSanitiser",type:e,pure:!0}),e}();function ne(e,t){if(1&e&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&e){var a=t.$implicit;_.Q6J("value",a),_.xp6(1),_.Oqu(a.name)}}function re(e,t){if(1&e&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&e){var a=t.$implicit;_.Q6J("value",a),_.xp6(1),_.hij("",a," pt")}}function oe(e,t){if(1&e&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&e){var a=t.$implicit;_.Q6J("value",a),_.xp6(1),_.hij("",a," pt")}}function ce(e,t){if(1&e&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&e){var a=t.$implicit;_.Q6J("value",a),_.xp6(1),_.hij("",a," pt")}}function le(e,t){if(1&e&&(_.TgZ(0,"mat-option",24),_._uU(1),_.qZA()),2&e){var a=t.$implicit;_.Q6J("value",a),_.xp6(1),_.hij("",a," pt")}}function se(e,t){if(1&e){var a=_.EpF();_.TgZ(0,"button",38),_.NdJ("click",function(){return _.CHM(a),_.oxw().setTemplateDefaults()}),_.SDv(1,39),_.qZA()}}function de(e,t){if(1&e&&_._UZ(0,"app-loading-notice",40),2&e){var a=_.oxw();_.Q6J("error",!!a.apiError)}}function ue(e,t){if(1&e&&(_.TgZ(0,"li"),_.SDv(1,47),_.qZA()),2&e){var a=_.oxw(2);_.xp6(1),_.pQV(a.apiError.overflow),_.QtT(1)}}var pe=function(){return["above","below"]};function fe(e,t){if(1&e&&(_.TgZ(0,"div",41),_.TgZ(1,"span"),_.SDv(2,42),_.qZA(),_.TgZ(3,"ul"),_.TgZ(4,"li"),_.SDv(5,43),_.qZA(),_.TgZ(6,"li"),_.SDv(7,44),_.qZA(),_.YNc(8,ue,2,1,"li",45),_.TgZ(9,"li"),_.SDv(10,46),_.qZA(),_.qZA(),_.qZA()),2&e){var a=_.oxw();_.xp6(5),_.pQV(a.apiError.overflow/2),_.QtT(5),_.xp6(2),_.pQV(a.apiError.overflow),_.QtT(7),_.xp6(1),_.Q6J("ngIf",_.DdM(3,pe).includes(a.board.captions_position))}}var ge,be=function(){var P=function(){function e(t,a,i,n,r,o,c,l){var s=this;q(this,e),this.boardService=t,this.templateService=a,this.route=i,this.router=n,this.location=r,this.sanitiser=o,this.hotkeysService=c,this.toolbarService=l,this.status="loading",this.compiledPdf="about:blank",this.pdfEmbedWidth=1e3,this.pdfEmbedHeight=600,this.showReset=!1,this.hotkeysService.add(new N.qm("escape",function(){return s.returnToBoard(),!1})),this.template=new Y,this.fontSizes=Array.from(Array(108).keys()),this.cellSpacingValues=Array.from(Array(51).keys()).filter(function(e){return e%5==0})}return D(e,[{key:"ngOnInit",value:function(){var e=this;this.boardService.get(this.route.snapshot.paramMap.get("board_id")).subscribe(function(t){e.board=t,e.setTemplateDefaults()}),this.toolbarService.setButtons([{text:"Board Set",icon:"arrow_back",action:function(){return e.router.navigate(["/","boardsets",e.route.snapshot.paramMap.get("id")])}}])}},{key:"setTemplateDefaults",value:function(){var e=this;this.showReset=!1,this.template.orientation=this.board.rows>this.board.logicalColumns?"portrait":"landscape",this.templateService.pageSizes().subscribe(function(t){e.pageSizes=t,e.template.pageSize=t.find(function(e){return"A4"===e.name}),e.template.fontSize=Math.round(e.template.pageSize.y/e.board.rows*.1),e.template.cellPadding=10,e.template.cellSpacing=10,e.template.drawCellBorders=!0,e.template.imageTextSpacing=-1,e.loadPdf()})}},{key:"onSettingChanged",value:function(){this.showReset=!0,this.loadPdf()}},{key:"loadPdf",value:function(){var e=this;this.status="loading",this.apiError=null,this.setEmbedHeight(),this.boardService.pdf(this.route.snapshot.paramMap.get("board_id"),this.template).then(function(t){e.compiledPdf=t,e.status="success"},function(t){return t.error.text().then(function(t){e.apiError=JSON.parse(t).error}),e.status="error"})}},{key:"setEmbedHeight",value:function(){this.pdfEmbedHeight="portrait"===this.template.orientation?this.pdfEmbedWidth*this.template.pageSize.ratio+60:this.pdfEmbedWidth/this.template.pageSize.ratio+60}},{key:"downloadPdf",value:function(){(0,O.saveAs)(this.compiledPdf,"".concat(this.board.name,".pdf"))}},{key:"returnToBoard",value:function(){this.board?this.router.navigate(["/","boardsets",this.board.board_set_id],{queryParams:{board:this.board.id}}).then():this.location.back()}}]),e}();return P.\u0275fac=function(e){return new(e||P)(_.Y36(I.$),_.Y36(R),_.Y36(k.gz),_.Y36(k.F0),_.Y36(J.Ye),_.Y36(U.H7),_.Y36(N.tm),_.Y36(B.O))},P.\u0275cmp=_.Xpm({type:P,selectors:[["app-pdf-preview"]],decls:70,vars:26,consts:function(){var q;return[[1,"section"],["fxLayout","column","fxLayoutAlign","center center"],[1,"mb-2",2,"max-width","750px","width","100%"],[1,"mb-3"],"Configuraci\xF3n de PDF",["fxLayout","row","fxLayoutGap","20px"],["appearance","outline","fxFlex","33"],"Tama\xF1o del papel",[3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],"orientaci\xF3n",["value","portrait"],"retrato",["value","landscape"],"paisaje","Tama\xF1o del texto (m\xE1ximo)","El texto puede reducirse para ajustarse al espacio disponible",[3,"expanded"],"Configuraci\xF3n avanzada","Espaciado de celda","Ajusta el espaciado entre cada cuadro","Relleno de celda","Ajusta el espaciado dentro de cada cuadro","Espaciado de imagen/etiqueta",[3,"value"],"Ajusta el espaciado entre la imagen y la etiqueta",[1,"mt-2"],[3,"ngModel","ngModelChange","change"],"Bordes de celda",["fxLayoutAlign","space-between center",1,"mt-2"],[1,"mb-1"],["mat-raised-button","","color","primary",1,"mr-2",3,"disabled","click"],"Descargar",["mat-icon-button","","aria-label","Actualizar PDF","matTooltip","Actualizar PDF","matTooltipPosition","right",3,"disabled","click"],["mat-button","","color","primary","mat-stroked-button","",3,"click",4,"ngIf"],["action","Generating","subject",q="PDF",3,"error",4,"ngIf"],["class","mt-3",4,"ngIf"],[2,"max-width","1000px","width","100%",3,"data","height"],["mat-button","","color","primary","mat-stroked-button","",3,"click"],"Restablecer configuraci\xF3n",["action","Generating","subject",q,3,"error"],[1,"mt-3"],"No podemos encajar todo en la p\xE1gina con la configuraci\xF3n elegida. Puede solucionar esto por\u2026","Reducir el espaciado de celda o el relleno de celdas en al menos " + "\ufffd0\ufffd" + " pt.","Reducci\xF3n del espaciado entre im\xE1genes y etiquetas en al menos " + "\ufffd0\ufffd" + " pt.",[4,"ngIf"],"Uso de un tama\xF1o de papel m\xE1s grande.","Reducir el tama\xF1o del texto en al menos " + "\ufffd0\ufffd" + " pt. "]},template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"div",1),_.TgZ(2,"div",2),_.TgZ(3,"h2",3),_.SDv(4,4),_.qZA(),_.TgZ(5,"div",5),_.TgZ(6,"mat-form-field",6),_.TgZ(7,"mat-label"),_.SDv(8,7),_.qZA(),_.TgZ(9,"mat-select",8),_.NdJ("valueChange",function(e){return t.template.pageSize=e})("valueChange",function(){return t.onSettingChanged()}),_.YNc(10,ne,2,2,"mat-option",9),_.qZA(),_.qZA(),_.TgZ(11,"mat-form-field",6),_.TgZ(12,"mat-label"),_.SDv(13,10),_.qZA(),_.TgZ(14,"mat-select",8),_.NdJ("valueChange",function(e){return t.template.orientation=e})("valueChange",function(){return t.onSettingChanged()}),_.TgZ(15,"mat-option",11),_.SDv(16,12),_.qZA(),_.TgZ(17,"mat-option",13),_.SDv(18,14),_.qZA(),_.qZA(),_.qZA(),_.TgZ(19,"mat-form-field",6),_.TgZ(20,"mat-label"),_.SDv(21,15),_.qZA(),_.TgZ(22,"mat-select",8),_.NdJ("valueChange",function(e){return t.template.fontSize=e})("valueChange",function(){return t.onSettingChanged()}),_.YNc(23,re,2,2,"mat-option",9),_.qZA(),_.TgZ(24,"mat-hint"),_.SDv(25,16),_.qZA(),_.qZA(),_.qZA(),_.TgZ(26,"mat-accordion"),_.TgZ(27,"mat-expansion-panel",17),_.TgZ(28,"mat-expansion-panel-header"),_.TgZ(29,"mat-panel-title"),_.SDv(30,18),_.qZA(),_.qZA(),_.TgZ(31,"div",5),_.TgZ(32,"mat-form-field",6),_.TgZ(33,"mat-label"),_.SDv(34,19),_.qZA(),_.TgZ(35,"mat-select",8),_.NdJ("valueChange",function(e){return t.template.cellSpacing=e})("valueChange",function(){return t.onSettingChanged()}),_.YNc(36,oe,2,2,"mat-option",9),_.qZA(),_.TgZ(37,"mat-hint"),_.SDv(38,20),_.qZA(),_.qZA(),_.TgZ(39,"mat-form-field",6),_.TgZ(40,"mat-label"),_.SDv(41,21),_.qZA(),_.TgZ(42,"mat-select",8),_.NdJ("valueChange",function(e){return t.template.cellPadding=e})("valueChange",function(){return t.onSettingChanged()}),_.YNc(43,ce,2,2,"mat-option",9),_.qZA(),_.TgZ(44,"mat-hint"),_.SDv(45,22),_.qZA(),_.qZA(),_.TgZ(46,"mat-form-field",6),_.TgZ(47,"mat-label"),_.SDv(48,23),_.qZA(),_.TgZ(49,"mat-select",8),_.NdJ("valueChange",function(e){return t.template.imageTextSpacing=e})("valueChange",function(){return t.onSettingChanged()}),_.TgZ(50,"mat-option",24),_._uU(51,"Automatic"),_.qZA(),_.YNc(52,le,2,2,"mat-option",9),_.qZA(),_.TgZ(53,"mat-hint"),_.SDv(54,25),_.qZA(),_.qZA(),_.qZA(),_.TgZ(55,"div",26),_.TgZ(56,"mat-checkbox",27),_.NdJ("ngModelChange",function(e){return t.template.drawCellBorders=e})("change",function(){return t.onSettingChanged()}),_.SDv(57,28),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(58,"div",29),_.TgZ(59,"div",30),_.TgZ(60,"button",31),_.NdJ("click",function(){return t.downloadPdf()}),_.SDv(61,32),_.qZA(),_.TgZ(62,"button",33),_.NdJ("click",function(){return t.loadPdf()}),_.TgZ(63,"mat-icon"),_._uU(64,"refresh"),_.qZA(),_.qZA(),_.qZA(),_.YNc(65,se,2,0,"button",34),_.qZA(),_.qZA(),_.YNc(66,de,1,1,"app-loading-notice",35),_.YNc(67,fe,11,4,"div",36),_._UZ(68,"object",37),_.ALo(69,"bypassSanitiser"),_.qZA(),_.qZA()),2&e&&(_.xp6(9),_.Q6J("value",t.template.pageSize),_.xp6(1),_.Q6J("ngForOf",t.pageSizes),_.xp6(4),_.Q6J("value",t.template.orientation),_.xp6(8),_.Q6J("value",t.template.fontSize),_.xp6(1),_.Q6J("ngForOf",t.fontSizes),_.xp6(4),_.Q6J("expanded",!1),_.xp6(8),_.Q6J("value",t.template.cellSpacing),_.xp6(1),_.Q6J("ngForOf",t.cellSpacingValues),_.xp6(6),_.Q6J("value",t.template.cellPadding),_.xp6(1),_.Q6J("ngForOf",t.cellSpacingValues),_.xp6(6),_.Q6J("value",t.template.imageTextSpacing),_.xp6(1),_.Q6J("value",-1),_.xp6(2),_.Q6J("ngForOf",t.cellSpacingValues),_.xp6(4),_.Q6J("ngModel",t.template.drawCellBorders),_.xp6(4),_.Q6J("disabled","success"!=t.status),_.xp6(2),_.Q6J("disabled","loading"==t.status),_.xp6(3),_.Q6J("ngIf",t.showReset),_.xp6(1),_.Q6J("ngIf","loading"===t.status||"error"===t.status),_.xp6(1),_.Q6J("ngIf","insufficient_cell_height"===(null==t.apiError?null:t.apiError.category)),_.xp6(1),_.Udp("visibility","success"===t.status?"visible":"hidden"),_.Q6J("data",_.xi3(69,23,t.compiledPdf,"resourceUrl"),_.uOi)("height",t.pdfEmbedHeight))},directives:[F.xw,F.Wh,F.SQ,H.KE,F.yH,H.hX,G.gD,J.sg,V.ey,H.bx,W.pp,W.ib,W.yz,W.yK,K.oG,X.JJ,X.On,$.lW,ee.gM,te.Hw,J.O5,ae.W],pipes:[ie],styles:["mat-progress-spinner[_ngcontent-%COMP%]{margin:30px auto}.section[_ngcontent-%COMP%]{margin:1rem}"]}),P}(),he=C(22797),me=C(75425),ve=[{path:":board_id",component:be,pathMatch:"full"}],Ze=((ge=function e(){q(this,e)}).\u0275fac=function(e){return new(e||ge)},ge.\u0275mod=_.oAB({type:ge}),ge.\u0275inj=_.cJS({imports:[[J.ez,k.Bz.forChild(ve),Q.Cq,F.ae,$.ot,X.u5,G.LD,he.QW,me.m,te.Ps,ee.AV,K.p9,W.To]]}),ge)}}])}();